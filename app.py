import streamlit as st
from collections import Counter

# Архетипические описания для чисел
ARCHETYPES = {
    1: {
        "название": "Путь Воина / Лидера",
        "описание": "Воплощение силы воли, инициативности, самостоятельности",
        "свет": "Новатор, лидер, уверенный в себе",
        "тень": "Упрямство, эгоизм, страх одиночества",
        "задача": "Иди своим путём, не бойся быть первой и уникальной",
        "рекомендации": "Смелее проявляй лидерство, начни проект, который давно откладываешь"
    },
    2: {
        "название": "Путь Дипломата",
        "описание": "Энергия чувствительности, партнёрства и интуиции",
        "свет": "Эмпатия, сотрудничество, мягкость",
        "тень": "Зависимость, неуверенность, избегание конфликта",
        "задача": "Учись выражать свои чувства и желания",
        "рекомендации": "Практикуй честные разговоры и укрепляй самооценку в парных отношениях"
    },
    3: {
        "название": "Путь Творца",
        "описание": "Энергия творчества, радости, самовыражения",
        "свет": "Харизма, вдохновение, спонтанность",
        "тень": "Поверхностность, неорганизованность",
        "задача": "Развивай дисциплину, доводи идеи до реализации",
        "рекомендации": "Запиши творческие идеи и выбери одну для реализации в течение недели"
    },
    4: {
        "название": "Путь Архитектора",
        "описание": "Энергия стабильности, структуры и надёжности",
        "свет": "Практичность, надёжность, устойчивость",
        "тень": "Ригидность, страх перемен",
        "задача": "Научись быть гибкой, разрешай себе спонтанность",
        "рекомендации": "Попробуй изменить распорядок дня — начни с малого, разреши себе импровизацию"
    },
    5: {
        "название": "Путь Искателя",
        "описание": "Энергия свободы, перемен, жажды познания",
        "свет": "Гибкость, общительность, любознательность",
        "тень": "Неустойчивость, избегание обязательств",
        "задача": "Учись выстраивать внутренние опоры",
        "рекомендации": "Запланируй путешествие или обучающий курс, чтобы расширить горизонты"
    },
    6: {
        "название": "Путь Заботы",
        "описание": "Энергия любви, служения, семьи",
        "свет": "Заботливость, надёжность, преданность",
        "тень": "Избыточный контроль, спасательство",
        "задача": "Балансируй между заботой о других и себе",
        "рекомендации": "Найди практики заботы о себе и соблюдай личные границы в отношениях"
    },
    7: {
        "название": "Путь Мудреца",
        "описание": "Энергия анализа, интуиции и уединения",
        "свет": "Глубина, размышление, знание",
        "тень": "Замкнутость, изоляция",
        "задача": "Открывайся миру, делись мудростью",
        "рекомендации": "Начни делиться знаниями — напиши пост или выступи с мини-лекцией"
    },
    8: {
        "название": "Путь Управителя",
        "описание": "Энергия власти, успеха, влияния",
        "свет": "Ответственность, организаторские способности",
        "тень": "Контроль, давление, жёсткость",
        "задача": "Учись делегировать и строить справедливые отношения",
        "рекомендации": "Проверь, где ты берёшь на себя лишнюю ответственность — и отпусти её"
    },
    9: {
        "название": "Путь Служителя",
        "описание": "Энергия гуманизма, сострадания, завершения",
        "свет": "Щедрость, зрелость, эмпатия",
        "тень": "Жертвенность, усталость от миссии",
        "задача": "Уважай свои границы, не растворяйся в других",
        "рекомендации": "Оцени, кому ты отдаёшь слишком много, и восстанови баланс энергии"
    },
    11: {
        "название": "Путь Пророка",
        "описание": "Энергия духовного канала, прозрения",
        "свет": "Интуиция, озарение, вдохновение",
        "тень": "Расфокусировка, тревожность",
        "задача": "Заземляй свои идеи, внедряй в практику",
        "рекомендации": "Создай ритуал для очищения ума — медитация, ведение дневника"
    },
    22: {
        "название": "Архитектор нового мира",
        "описание": "Масштабное созидание, глобальные идеи",
        "свет": "Мастерство, организатор больших систем",
        "тень": "Страх провала, выгорание",
        "задача": "Действуй пошагово, доверяй внутренней опоре",
        "рекомендации": "Сконцентрируйся на одном важном проекте и выстраивай чёткий план"
    },
    33: {
        "название": "Учитель Учителей",
        "описание": "Безусловная любовь, служение человечеству",
        "свет": "Сострадание, целительство, вдохновение",
        "тень": "Спасательство, самопожертвование, выгорание",
        "задача": "Создавай границы, чтобы сохранить энергию",
        "рекомендации": "Развивай практики восстановления энергии и осознанного взаимодействия"
    }
}

# 🎯 Психологический портрет на основе матрицы

def render_psychological_portrait(energies):
    st.subheader("🎯 Психологический портрет")
    counts = Counter(energies)

    # Повторы
    repeated = [f"Число {k} ({v} раз) — {ARCHETYPES[k]['название']}" for k, v in counts.items() if v > 1]
    if repeated:
        st.markdown("**Повторяющиеся энергии:**")
        for line in repeated:
            st.markdown(f"- {line}")

    # Мастер-энергии
    master_numbers = [k for k in energies if k in [11, 22, 33]]
    if master_numbers:
        st.markdown("**Мастер-энергии в матрице:**")
        for m in set(master_numbers):
            st.markdown(f"- {m} — {ARCHETYPES[m]['название']}")

    # Ключевые темы
    if 1 in energies and 33 in energies:
        st.markdown("**Внутренний конфликт:** Служение (33) ↔ Самость (1). Научиться сочетать помощь другим с проявлением себя.")

    st.markdown("\n---\n")

# 🔢 Ввод данных и запуск расчёта

st.title("🔢 Числа Судьбы")
st.markdown("Введите дату рождения для расчёта личной нумерологической матрицы")

col1, col2, col3 = st.columns(3)
with col1:
    day = st.number_input("День", min_value=1, max_value=31, value=1)
with col2:
    month = st.number_input("Месяц", min_value=1, max_value=12, value=1)
with col3:
    year = st.number_input("Год", min_value=1900, max_value=2100, value=1984)

if st.button("🔮 Рассчитать"):
    def reduce(n):
        while n not in [11, 22, 33] and n > 9:
            n = sum(int(i) for i in str(n))
        return n

    soul_path = reduce(sum(int(i) for i in f"{day:02d}{month:02d}{year}"))
    soul_number = reduce(day)
    karma_tail = reduce(day + month)
    gift = reduce(day + year)
    body_code = reduce(month)
    birth_year_code = reduce(sum(int(i) for i in str(year)))
    soul_gate = reduce(abs(soul_number - karma_tail))
    abundance_code = reduce(gift + body_code)
    incarnation_memory = reduce(birth_year_code + karma_tail)
    realization_channel = reduce(soul_path + gift)
    love_channel = reduce(karma_tail + body_code)
    spirit_channel = reduce(soul_path + birth_year_code)

    results = {
        "Число Жизненного Пути": soul_path,
        "Число Души": soul_number,
        "Число Кармы": karma_tail,
        "Дар / Потенциал": gift,
        "Код Тела / Реализации": body_code,
        "Энергия года рождения": birth_year_code,
        "Врата Души": soul_gate,
        "Код Изобилия": abundance_code,
        "Инкарнационная память": incarnation_memory,
        "Канал Реализации": realization_channel,
        "Канал Любви": love_channel,
        "Канал Духа": spirit_channel
    }

    all_energies = list(results.values())

    for k, v in results.items():
        archetype = ARCHETYPES.get(v, {})
        st.subheader(f"🔹 {k}: {v} — {archetype.get('название', 'Неизвестно')}")
        st.markdown(f"**Суть:** {archetype.get('описание', '—')}")
        st.markdown(f"**Свет:** {archetype.get('свет', '—')}")
        st.markdown(f"**Тень:** {archetype.get('тень', '—')}")
        st.markdown(f"**Задача:** {archetype.get('задача', '—')}")
        st.markdown(f"**Рекомендации:** {archetype.get('рекомендации', '—')}")
        st.markdown("---")

    render_psychological_portrait(all_energies)
