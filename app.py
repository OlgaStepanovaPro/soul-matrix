import streamlit as st
from collections import Counter

# –ê—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —á–∏—Å–µ–ª
ARCHETYPES = {
    1: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ü—É—Ç—å –í–æ–∏–Ω–∞ / –õ–∏–¥–µ—Ä–∞",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–í–æ–ø–ª–æ—â–µ–Ω–∏–µ —Å–∏–ª—ã –≤–æ–ª–∏, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "—Å–≤–µ—Ç": "–ù–æ–≤–∞—Ç–æ—Ä, –ª–∏–¥–µ—Ä, —É–≤–µ—Ä–µ–Ω–Ω—ã–π –≤ —Å–µ–±–µ",
        "—Ç–µ–Ω—å": "–£–ø—Ä—è–º—Å—Ç–≤–æ, —ç–≥–æ–∏–∑–º, —Å—Ç—Ä–∞—Ö –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞",
        "–∑–∞–¥–∞—á–∞": "–ò–¥–∏ —Å–≤–æ–∏–º –ø—É—Ç—ë–º, –Ω–µ –±–æ–π—Å—è –±—ã—Ç—å –ø–µ—Ä–≤–æ–π –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–°–º–µ–ª–µ–µ –ø—Ä–æ—è–≤–ª—è–π –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, –Ω–∞—á–Ω–∏ –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—à—å"
    },
    5: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ü—É—Ç—å –ò—Å–∫–∞—Ç–µ–ª—è",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–≠–Ω–µ—Ä–≥–∏—è —Å–≤–æ–±–æ–¥—ã, –ø–µ—Ä–µ–º–µ–Ω, –∂–∞–∂–¥—ã –ø–æ–∑–Ω–∞–Ω–∏—è",
        "—Å–≤–µ—Ç": "–ì–∏–±–∫–æ—Å—Ç—å, –æ–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        "—Ç–µ–Ω—å": "–ù–µ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∏–∑–±–µ–≥–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤",
        "–∑–∞–¥–∞—á–∞": "–£—á–∏—Å—å –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–æ—Ä—ã",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∏–ª–∏ –æ–±—É—á–∞—é—â–∏–π –∫—É—Ä—Å, —á—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ä–∏—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã"
    },
    7: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ü—É—Ç—å –ú—É–¥—Ä–µ—Ü–∞",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–≠–Ω–µ—Ä–≥–∏—è –∞–Ω–∞–ª–∏–∑–∞, –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ —É–µ–¥–∏–Ω–µ–Ω–∏—è",
        "—Å–≤–µ—Ç": "–ì–ª—É–±–∏–Ω–∞, —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ, –∑–Ω–∞–Ω–∏–µ",
        "—Ç–µ–Ω—å": "–ó–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å, –∏–∑–æ–ª—è—Ü–∏—è",
        "–∑–∞–¥–∞—á–∞": "–û—Ç–∫—Ä—ã–≤–∞–π—Å—è –º–∏—Ä—É, –¥–µ–ª–∏—Å—å –º—É–¥—Ä–æ—Å—Ç—å—é",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–ù–∞—á–Ω–∏ –¥–µ–ª–∏—Ç—å—Å—è –∑–Ω–∞–Ω–∏—è–º–∏ ‚Äî –Ω–∞–ø–∏—à–∏ –ø–æ—Å—Ç –∏–ª–∏ –≤—ã—Å—Ç—É–ø–∏ —Å –º–∏–Ω–∏-–ª–µ–∫—Ü–∏–µ–π"
    },
    9: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ü—É—Ç—å –°–ª—É–∂–∏—Ç–µ–ª—è",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–≠–Ω–µ—Ä–≥–∏—è –≥—É–º–∞–Ω–∏–∑–º–∞, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è",
        "—Å–≤–µ—Ç": "–©–µ–¥—Ä–æ—Å—Ç—å, –∑—Ä–µ–ª–æ—Å—Ç—å, —ç–º–ø–∞—Ç–∏—è",
        "—Ç–µ–Ω—å": "–ñ–µ—Ä—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —É—Å—Ç–∞–ª–æ—Å—Ç—å –æ—Ç –º–∏—Å—Å–∏–∏",
        "–∑–∞–¥–∞—á–∞": "–£–≤–∞–∂–∞–π —Å–≤–æ–∏ –≥—Ä–∞–Ω–∏—Ü—ã, –Ω–µ —Ä–∞—Å—Ç–≤–æ—Ä—è–π—Å—è –≤ –¥—Ä—É–≥–∏—Ö",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–û—Ü–µ–Ω–∏, –∫–æ–º—É —Ç—ã –æ—Ç–¥–∞—ë—à—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ –±–∞–ª–∞–Ω—Å —ç–Ω–µ—Ä–≥–∏–∏"
    },
    22: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ –º–∏—Ä–∞",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–ú–∞—Å—à—Ç–∞–±–Ω–æ–µ —Å–æ–∑–∏–¥–∞–Ω–∏–µ, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏",
        "—Å–≤–µ—Ç": "–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –±–æ–ª—å—à–∏—Ö —Å–∏—Å—Ç–µ–º",
        "—Ç–µ–Ω—å": "–°—Ç—Ä–∞—Ö –ø—Ä–æ–≤–∞–ª–∞, –≤—ã–≥–æ—Ä–∞–Ω–∏–µ",
        "–∑–∞–¥–∞—á–∞": "–î–µ–π—Å—Ç–≤—É–π –ø–æ—à–∞–≥–æ–≤–æ, –¥–æ–≤–µ—Ä—è–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ–ø–æ—Ä–µ",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Å—è –Ω–∞ –æ–¥–Ω–æ–º –≤–∞–∂–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞–π —á—ë—Ç–∫–∏–π –ø–ª–∞–Ω"
    },
    33: {
        "–Ω–∞–∑–≤–∞–Ω–∏–µ": "–£—á–∏—Ç–µ–ª—å –£—á–∏—Ç–µ–ª–µ–π",
        "–æ–ø–∏—Å–∞–Ω–∏–µ": "–ë–µ–∑—É—Å–ª–æ–≤–Ω–∞—è –ª—é–±–æ–≤—å, —Å–ª—É–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤—É",
        "—Å–≤–µ—Ç": "–°–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, —Ü–µ–ª–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ",
        "—Ç–µ–Ω—å": "–°–ø–∞—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —Å–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ, –≤—ã–≥–æ—Ä–∞–Ω–∏–µ",
        "–∑–∞–¥–∞—á–∞": "–°–æ–∑–¥–∞–≤–∞–π –≥—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é",
        "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": "–†–∞–∑–≤–∏–≤–∞–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è"
    }
}

def calculate_matrix(day, month, year):
    def reduce(n):
        while n > 9 and n not in [11, 22, 33]:
            n = sum(int(d) for d in str(n))
        return n

    d = sum(int(i) for i in str(day))
    m = sum(int(i) for i in str(month))
    y = sum(int(i) for i in str(year))

    soul_code = reduce(d + m + y)
    karma_tail = reduce(d + m)
    life_path = reduce(soul_code + karma_tail)
    gift = reduce(d + y)
    body_code = reduce(m)
    birth_year_code = reduce(y)
    soul_gate = reduce(abs(soul_code - karma_tail))
    abundance_code = reduce(gift + body_code)
    incarnation_memory = reduce(birth_year_code + karma_tail)
    realization_code = reduce(life_path + gift)
    love_code = reduce(karma_tail + body_code)
    spirit_code = reduce(life_path + birth_year_code)

    return {
        "–ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏": life_path,
        "–ß–∏—Å–ª–æ –î—É—à–∏": soul_code,
        "–ß–∏—Å–ª–æ –ö–∞—Ä–º—ã": karma_tail,
        "–î–∞—Ä / –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª": gift,
        "–ö–æ–¥ –¢–µ–ª–∞ / –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏": body_code,
        "–≠–Ω–µ—Ä–≥–∏—è –≥–æ–¥–∞ —Ä–æ–∂–¥–µ–Ω–∏—è": birth_year_code,
        "–í—Ä–∞—Ç–∞ –î—É—à–∏": soul_gate,
        "–ö–æ–¥ –ò–∑–æ–±–∏–ª–∏—è": abundance_code,
        "–ò–Ω–∫–∞—Ä–Ω–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å": incarnation_memory,
        "–ö–∞–Ω–∞–ª –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏": realization_code,
        "–ö–∞–Ω–∞–ª –õ—é–±–≤–∏": love_code,
        "–ö–∞–Ω–∞–ª –î—É—Ö–∞": spirit_code
    }

# üéØ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ç—Ä–∏—Ü—ã

def render_psychological_portrait(energies):
    st.subheader("üéØ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç")
    counts = Counter(energies)

    # –ü–æ–≤—Ç–æ—Ä—ã
    repeated = [f"–ß–∏—Å–ª–æ {k} ({v} —Ä–∞–∑) ‚Äî {ARCHETYPES[k]['–Ω–∞–∑–≤–∞–Ω–∏–µ']}" for k, v in counts.items() if v > 1]
    if repeated:
        st.markdown("**–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —ç–Ω–µ—Ä–≥–∏–∏:**")
        for line in repeated:
            st.markdown(f"- {line}")

    # –ú–∞—Å—Ç–µ—Ä-—ç–Ω–µ—Ä–≥–∏–∏
    master_numbers = [k for k in energies if k in [11, 22, 33]]
    if master_numbers:
        st.markdown("**–ú–∞—Å—Ç–µ—Ä-—ç–Ω–µ—Ä–≥–∏–∏ –≤ –º–∞—Ç—Ä–∏—Ü–µ:**")
        for m in set(master_numbers):
            st.markdown(f"- {m} ‚Äî {ARCHETYPES[m]['–Ω–∞–∑–≤–∞–Ω–∏–µ']}")

    # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
    if 1 in energies and 33 in energies:
        st.markdown("**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç:** –°–ª—É–∂–µ–Ω–∏–µ (33) ‚Üî –°–∞–º–æ—Å—Ç—å (1). –ù–∞—É—á–∏—Ç—å—Å—è —Å–æ—á–µ—Ç–∞—Ç—å –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º —Å –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ–º —Å–µ–±—è.")

    # –û–±–æ–±—â—ë–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç
    if counts:
        dominant = counts.most_common(1)[0][0]
        archetype = ARCHETYPES.get(dominant)
        if archetype:
            st.markdown("**–û–±–æ–±—â—ë–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç:**")
            st.markdown(f"–í—ã—Ä–∞–∂–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è: **{dominant} ‚Äî {archetype['–Ω–∞–∑–≤–∞–Ω–∏–µ']}**")
            st.markdown(f"–°—É—Ç—å: {archetype['–æ–ø–∏—Å–∞–Ω–∏–µ']}")
            st.markdown(f"–ö–ª—é—á–µ–≤–æ–π –≤–µ–∫—Ç–æ—Ä —Ä–∞–∑–≤–∏—Ç–∏—è: {archetype['–∑–∞–¥–∞—á–∞']}")
            st.markdown(f"–ü–æ–¥–¥–µ—Ä–∂–∫–∞: {archetype['—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏']}")

    st.markdown("\n---\n")

# üí´ –í—ã–∑–æ–≤ —Ä–∞—Å—á—ë—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
st.title("üî¢ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —á–∏—Å–µ–ª —Å—É–¥—å–±—ã")
day = st.number_input("–î–µ–Ω—å", min_value=1, max_value=31, value=1)
month = st.number_input("–ú–µ—Å—è—Ü", min_value=1, max_value=12, value=1)
year = st.number_input("–ì–æ–¥", min_value=1900, max_value=2100, value=1984)

if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"):
    result = calculate_matrix(day, month, year)
    for –Ω–∞–∑–≤–∞–Ω–∏–µ, –∑–Ω–∞—á–µ–Ω–∏–µ in result.items():
        if –∑–Ω–∞—á–µ–Ω–∏–µ in ARCHETYPES:
            archetype = ARCHETYPES[–∑–Ω–∞—á–µ–Ω–∏–µ]
            st.markdown(f"### üîπ {–Ω–∞–∑–≤–∞–Ω–∏–µ}: {–∑–Ω–∞—á–µ–Ω–∏–µ} ‚Äî {archetype['–Ω–∞–∑–≤–∞–Ω–∏–µ']}")
            st.markdown(f"**–°—É—Ç—å:** {archetype['–æ–ø–∏—Å–∞–Ω–∏–µ']}")
            st.markdown(f"**–°–≤–µ—Ç:** {archetype['—Å–≤–µ—Ç']}")
            st.markdown(f"**–¢–µ–Ω—å:** {archetype['—Ç–µ–Ω—å']}")
            st.markdown(f"**–ó–∞–¥–∞—á–∞:** {archetype['–∑–∞–¥–∞—á–∞']}")
            st.markdown(f"**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** {archetype['—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏']}")
            st.markdown("\n")
        else:
            st.markdown(f"### üîπ {–Ω–∞–∑–≤–∞–Ω–∏–µ}: {–∑–Ω–∞—á–µ–Ω–∏–µ}")
            st.markdown("–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n")

    energies = list(result.values())
    render_psychological_portrait(energies)
