# Матрица Души: калькулятор по дате рождения с веб‑интерфейсом Streamlit

import streamlit as st

# ▶️ 1. Таблица архетипов (число → описание)
ARCHETYPES = {
    1: {"архетип": "Воин, Маг, Прометей — энергия действия, инициативы, лидерства", "свет": "Решимость, воля, способность начинать и вести за собой.", "тень": "Авторитарность, упрямство, нетерпимость к слабости.", "рекомендации": "Учитесь слышать других и учитывать их вклад. Развивайте мудрое лидерство.", "color": "#E53935"},
    2: {"архетип": "Дипломат, Лунная Жрица — энергия чувств, интуиции и партнёрства", "свет": "Эмпатия, гармония, способность к союзам и партнёрству.", "тень": "Зависимость, подавление себя, обидчивость.", "рекомендации": "Сохраняйте границы в отношениях, учитесь выражать свои желания.", "color": "#FB8C00"},
    3: {"архетип": "Артист, Ребёнок, Муза — энергия творчества, радости, самовыражения", "свет": "Творчество, харизма, лёгкость.", "тень": "Поверхностность, избегание ответственности.", "рекомендации": "Развивайте самодисциплину, направляйте энергию в проекты.", "color": "#FDD835"},
    4: {"архетип": "Архитектор, Хранитель — энергия порядка, стабильности, системы", "свет": "Надёжность, устойчивость, умение выстраивать структуры.", "тень": "Скука, ригидность, страх перемен.", "рекомендации": "Учитесь гибкости. Позвольте себе спонтанность.", "color": "#43A047"},
    5: {"архетип": "Искатель, Одиссей — энергия движения, свободы, познания", "свет": "Свобода, любознательность, прогресс.", "тень": "Импульсивность, нестабильность, избегание ответственности.", "рекомендации": "Стабилизируйте внутренние опоры, чтобы свободно двигаться во вне.", "color": "#1E88E5"},
    6: {"архетип": "Деметра, Хранительница очага — энергия заботы, семьи и любви", "свет": "Любовь, забота, верность.", "тень": "Избыточная жертвенность, контроль под маской заботы.", "рекомендации": "Развивайте заботу о себе. Балансируйте между отдачей и получением.", "color": "#43A047"},
    7: {"архетип": "Мудрец, Отшельник — энергия познания, интуиции и глубины", "свет": "Интуиция, знание, глубина.", "тень": "Изоляция, отчуждённость, холодность.", "рекомендации": "Открывайтесь миру. Делитесь своей мудростью.", "color": "#5E35B1"},
    8: {"архетип": "Управленец, Судья — энергия власти, влияния и структуры", "свет": "Сила, ответственность, организаторские способности.", "тень": "Контроль, жёсткость, подавление.", "рекомендации": "Учитесь делегировать и развивать справедливое лидерство.", "color": "#3949AB"},
    9: {"архетип": "Миссионер, Старец — энергия служения, гуманизма и мудрости", "свет": "Сострадание, зрелость, служение.", "тень": "Усталость, самопожертвование, моральное превосходство.", "рекомендации": "Балансируйте между служением другим и заботой о себе.", "color": "#F9A825"},
    11: {"архетип": "Пророк, Видящий — энергия прозрения, интуиции, духовного канала", "свет": "Духовные озарения, интуиция, вдохновение.", "тень": "Растерянность, тревожность, избегание материи.", "рекомендации": "Заземляйтесь, оформляйте свои озарения в практику.", "color": "#BA68C8"},
    22: {"архетип": "Архитектор нового мира — энергия масштабных задач и созидания", "свет": "Глобальные проекты, мастерство реализации.", "тень": "Страх провала, давление, стремление к идеалу.", "рекомендации": "Действуйте шаг за шагом. Помните, даже великое начинается с малого.", "color": "#FFD700"},
    33: {"архетип": "Учитель Учителей — энергия духовного служения и безусловной любви", "свет": "Безусловная любовь, духовное служение.", "тень": "Выгорание, самопожертвование, спасательство.", "рекомендации": "Создавайте границы, чтобы сохранять энергию и быть опорой для других.", "color": "#FFFFFF"}
}

# ▶️ 1.1. Практики для теней
PRACTICES = {
    1: ["Медитировать на принятие других", "Практиковать мягкость в коммуникации"],
    2: ["Устанавливать личные границы", "Выражать свои желания вслух"],
    3: ["Вести дневник самоподдержки", "Практиковать благодарность"],
    4: ["Привыкать к спонтанности", "Внедрять новое хобби"],
    5: ["Дышать осознанно перед действием", "Составлять ежедневный план"],
    6: ["Уделять время себе", "Говорить 'нет' без чувства вины"],
    7: ["Участвовать в групповых обсуждениях", "Делиться знаниями"],
    8: ["Делегировать задачи", "Практиковать гибкость мышления"],
    9: ["Самосострадание", "Забота о собственных потребностях"],
    11: ["Вести практику заземления", "Прописывать идеи на бумаге"],
    22: ["Делить большие цели на этапы", "Просить помощи"],
    33: ["Устанавливать границы в служении", "Время для оздоровления"]
}

# ▶️ 2. Описание позиций матрицы
POSITION_DESC = {
    "Код Души": "Глубинная суть личности, ядро энергии вашего Я.",
    "Кармический хвост": "Опыт прошлых жизней и то, что нужно отпустить/проработать.",
    "Путь Души": "Миссия, направление роста и самореализации.",
    "Дар/Потенциал": "Ваш врождённый талант и естественный ресурс.",
    "Код тела/реализация": "Как через тело и действия проявляется энергия.",
    "Энергия года рождения": "Фоновая сила, влияющая на поколение и масштаб задач.",
    "Врата Души": "Ключевой урок, точка трансформации между Душой и кармой.",
    "Код Изобилия": "Как открывается поток ресурсов и материальной поддержки.",
    "Инкарнационная память": "Подсознательные сценарии, идущие из прошлых воплощений.",
    "Канал реализации": "Практическая сцена, где лучше всего проявлять себя.",
    "Канал любви": "Особенности отношений и сердечного обмена.",
    "Канал духа": "Как приходит вдохновение и духовная энергия.",
    "Северный узел (Раху)": "Направление роста души, уроки будущего, что следует развивать.",
    "Южный узел (Кету)": "Теневые моменты прошлых жизней, то, от чего надо освободиться."
}

# ▶️ 3. Вспомогательные функции

def reduce_number(n):
    while n not in [11, 22, 33] and n > 9:
        n = sum(int(d) for d in str(n))
    return n

def calculate_matrix(day, month, year):
    d, m, y = sum(map(int, str(day))), sum(map(int, str(month))), sum(map(int, str(year)))
    soul, karma, path = reduce_number(d+m+y), reduce_number(d+m), None
    path = reduce_number(soul+karma)
    gift, body, birth = reduce_number(d), reduce_number(m), reduce_number(y)
    gate, abound = reduce_number(abs(soul-karma)), reduce_number(gift+body)
    incarn = reduce_number(birth+karma)
    real, love, spirit = reduce_number(path+gift), reduce_number(karma+body), reduce_number(path+birth)
    north, south = reduce_number(soul+path), reduce_number(karma+gate)
    return {
        "Код Души": soul, "Кармический хвост": karma, "Путь Души": path,
        "Дар/Потенциал": gift, "Код тела/реализация": body, "Энергия года рождения": birth,
        "Врата Души": gate, "Код Изобилия": abound, "Инкарнационная память": incarn,
        "Канал реализации": real, "Канал любви": love, "Канал духа": spirit,
        "Северный узел (Раху)": north, "Южный узел (Кету)": south
    }

# ▶️ 4. Streamlit-интерфейс
st.set_page_config(page_title="Матрица Души", page_icon="🌀")
st.title("🌀 Калькулятор Матрицы Души")
st.markdown("Введите дату рождения, чтобы рассчитать вашу матрицу")

# Чекбокс для графического круга
show_circle = st.checkbox('Показать энергетический круг')

col1, col2, col3 = st.columns(3)
with col1:
    day = st.number_input("День", 1, 31, 1)
with col2:
    month = st.number_input("Месяц", 1, 12, 1)
with col3:
    year = st.number_input("Год", 1900, 2100, 1984)

if st.button("Рассчитать матрицу"):
    res = calculate_matrix(day, month, year)
    
    # Кармические узлы
    st.subheader("🌗 Кармические узлы")
    nn, sn = res["Северный узел (Раху)"], res["Южный узел (Кету)"]
    st.markdown(f"**Северный узел (Раху):** `{nn}` — {POSITION_DESC['Северный узел (Раху)']}**")
    info_nn = ARCHETYPES.get(nn)
    if info_nn:
        st.markdown(f"🔹 **Архетип Раху:** *{info_nn['архетип']}*")
        st.markdown(f"🟢 **Свет Раху:** {info_nn['свет']}")
        # Развернутый блок тени и практик
        with st.expander("Подробнее по тени Раху"):
            st.write(info_nn['тень'])
            practice_nn = PRACTICES.get(nn, [])
            st.multiselect("Практики для Раху", practice_nn, practice_nn)
        st.markdown(f"💡 **Рекомендации для Раху:** {info_nn['рекомендации']}")
    st.markdown(f"**Южный узел (Кету):** `{sn}` — {POSITION_DESC['Южный узел (Кету)']}**")
    info_sn = ARCHETYPES.get(sn)
    if info_sn:
        st.markdown(f"🔹 **Архетип Кету:** *{info_sn['архетип']}*")
        st.markdown(f"🟢 **Свет Кету:** {info_sn['свет']}")
        with st.expander("Подробнее по тени Кету"):
            st.write(info_sn['тень'])
            practice_sn = PRACTICES.get(sn, [])
            st.multiselect("Практики для Кету", practice_sn, practice_sn)
        st.markdown(f"💡 **Рекомендации для Кету:** {info_sn['рекомендации']}")
    
    # Графический круг
    if show_circle:
        st.subheader("🌀 Энергетический круг")
        # вызов функции draw_energy_circle(res) для визуализации
        st.plotly_chart(draw_energy_circle(res), use_container_width=True)

    # Основные позиции и связи
    st.subheader("✨ Результаты:")
    links = [("Врата Души","Дар/Потенциал"),("Код Изобилия","Кармический хвост"),
             ("Канал реализации","Путь Души"),("Канал любви","Код тела/реализация"),
             ("Канал духа","Энергия года рождения")]
    for pos, code in res.items():
        if pos in ["Северный узел (Раху)","Южный узел (Кету)"]:
            continue
        color = ARCHETYPES.get(code, {}).get("color", "#000000")
        st.markdown(f"### <span style='color:{color};'>●</span> **{pos}**", unsafe_allow_html=True)
        st.markdown(f"<span style='font-size:90%; color:#555;'>{POSITION_DESC.get(pos,'')}</span>",unsafe_allow_html=True)
        st.markdown(f"**Код:** `{code}`")
        if code in [11,22,33]: st.markdown("✨ Это **Мастер-энергия** — усиленная архетипическая задача и потенциал.")
        info = ARCHETYPES.get(code)
        if info:
            st.markdown(f"🔹 **Архетип:** *{info['архетип']}*")
            st.markdown(f"🟢 **Свет:** {info['свет']}")
            with st.expander("Подробнее по тени"):
                st.write(info['тень'])
                practices = PRACTICES.get(code, [])
                st.multiselect("Практики для тени", practices, practices)
            st.markdown(f"💡 **Рекомендации:** {info['рекомендации']}")
        for a,b in links:
            if res.get(a)==res.get(b)==code:
                master = " ✨ (Мастер-энергия)" if code in [11,22,33] else ""
                arch = ARCHETYPES[code]['архетип']
                st.markdown(f"🔁 **{a} ↔ {b}** — общий архетип: *{arch}*{master}.")
                st.markdown("<span style='color:#888;'>Одна и та же энергия раскрывается в этих двух зонах жизни.</span>",unsafe_allow_html=True)
        st.write("---")

# ▶️ 5. Функция для рисования круга (заглушка)
def draw_energy_circle(result):
    import plotly.graph_objs as go
    # Реализация визуализации будет здесь
    fig = go.Figure()
    return fig
